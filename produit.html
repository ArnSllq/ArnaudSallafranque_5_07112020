<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>Orinoco</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="style.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

        <script src="https://kit.fontawesome.com/ab16bb9001.js" crossorigin="anonymous"></script>
        <script src="myScript.js"></script>
    </head>

    <body>
        <header>
            <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
                <a class="navbar-brand" href="index.html"><i class="fas fa-shopping-cart"></i>Orinoco</a>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cart.html">Panier</a>
                        </li>
                    </ul>
                </div>
                

            </nav>
        </header>

        <main>
            <div class="row justify-content-center" id="TEDIBER">
            </div>
            <script>
                    function init() {
                    let thatOneTeddy = "/" + location.search.slice(1).split("=")[1];
                    console.log(thatOneTeddy);


                    let getTeddies = new XMLHttpRequest();
                        getTeddies.onreadystatechange = function() {
                            if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
                                let response = JSON.parse(this.responseText);
                                console.log(response);
                                console.log(response.colors.length);
                                let tedProduct = document.getElementById("TEDIBER");
                                tedProduct.innerHTML+='<div class="col-lg-4"><img class="img-fluid" src="'+response.imageUrl+'" alt="'+response.name+'"><p class="Teddies-name">'+response.name+'</p><div class="form-group"><label for="exampleFormControlSelect1">Choisir la couleur :</label><select class="form-control Teddies-color" id="exampleFormControlSelect1"><option>Plusieurs couleurs disponibles</option></select></div><p class="Teddies-price">'+response.price+'</p><input class="Teddies-number" type="number" value="0" min="1" max="1000" step="1"/><button type="button" class="btn btn-outline-warning" id="Teddies-cart">Ajouter au panier</button></div>';

                                let teddiesColor = document.getElementsByTagName("select")[0];
                                
                                for(i = 0; i < response.colors.length; i++) {
                                    teddiesColor.innerHTML+='<option>'+response.colors[i]+'</option>';
                                }
                                
                                function tedInTheCart() {
                                    let tedName = document.getElementsByClassName("Teddies-name").innerHTML= response.name;
                                    let tedPrice = document.getElementsByClassName("Teddies-price").innerHTML= response.price;
                                    let tedColor = document.getElementsByClassName("Teddies-color")[0].value;
                                    let tedNumber = document.getElementsByClassName("Teddies-number")[0].value;

                                    let tedStore = {
                                        "name" : tedName,
                                        "price" : tedPrice,
                                        "color" : tedColor,
                                        "quantity" : parseInt(tedNumber)
                                    };

                                    if (localStorage.length > 0) {
                                        let monBoTab = [JSON.parse(localStorage.getItem("tedArray"))];
                                        monBoTab.push(tedStore);
                                        localStorage.setItem("tedArray", JSON.stringify(monBoTab));   
                                        // localStorage.setItem("tedArray", monBoTab);    
                                        console.log(monBoTab);
                                    } else {
                                        let myFirstItem = localStorage.setItem("tedArray", JSON.stringify(tedStore));
                                        console.log(localStorage);
                                    };
                                };

                                document.getElementById("Teddies-cart").addEventListener("click", tedInTheCart);
                            }
                        };


                        
                getTeddies.open('GET', 'https://jwdp5.herokuapp.com/api/teddies'+thatOneTeddy+'');
                getTeddies.send();
            }
            
            init()
            </script>

        </main>
    </body>